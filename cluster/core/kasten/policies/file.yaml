---
kind: Policy
apiVersion: config.kio.kasten.io/v1alpha1
metadata:
  name: file  # 备份计划名
  namespace: kasten-io
spec:
  selector:
    matchExpressions:
      - key: k10.kasten.io/appNamespace  # 根据命名空间来匹配需要备份的东西
        operator: In
        values:
          - file-service

  frequency: "@daily"  # 每星期启动一次备份
  subFrequency:
    minutes:
      - 0
    hours:
      - 20  # UTC时间，加八个小时后是凌晨4点，会在这个时间点启动
  retention: # 保留的备份数量
    daily: 7
    weekly: 4
    monthly: 1
  actions:
    - action: backup  # 使用快照进行备份
      backupParameters:
        filters: { }  # 不设置类型过滤，备份匹配到的整个命名空间的所有东西
        profile:
          name: tencentcloud
          namespace: kasten-io
    - action: export
      exportParameters:
        frequency: "@weekly"  # 每星期导出一次
        profile:
          name: tencentcloud
          namespace: kasten-io
        exportData: # 导出完整备份
          enabled: true
      retention: # 保留的备份数量
        weekly: 1
